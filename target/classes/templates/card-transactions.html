<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Credit Card Transactions</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body class="container mt-5">

<div class="card shadow p-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="text-primary mb-0">Credit Card Transactions</h2>
        <a href="/user/dashboard" class="btn btn-secondary">← Dashboard</a>
    </div>

    <div class="mb-3">
        <strong>Application ID:</strong>
        <span th:text="${appId}"></span>
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-bordered align-middle text-center">
            <thead class="table-dark">
            <tr>
                <th>
                    <a th:href="@{'/card/' + ${appId} + '/transactions?page=0&sortField=transactionId&sortDir=' + ${reverseSortDir}}"
                       class="text-white text-decoration-none">
                        Transaction ID
                        <span th:if="${sortField == 'transactionId'}"
                              th:text="${sortDir == 'asc' ? '↑' : '↓'}"></span>
                    </a>
                </th>

                <th>
                    <a th:href="@{'/card/' + ${appId} + '/transactions?page=0&sortField=transactionDate&sortDir=' + ${reverseSortDir}}"
                       class="text-white text-decoration-none">
                        Date & Time
                        <span th:if="${sortField == 'transactionDate'}"
                              th:text="${sortDir == 'asc' ? '↑' : '↓'}"></span>
                    </a>
                </th>

                <th>
                    <a th:href="@{'/card/' + ${appId} + '/transactions?page=0&sortField=amount&sortDir=' + ${reverseSortDir}}"
                       class="text-white text-decoration-none">
                        Amount
                        <span th:if="${sortField == 'amount'}"
                              th:text="${sortDir == 'asc' ? '↑' : '↓'}"></span>
                    </a>
                </th>

                <th>
                    <a th:href="@{'/card/' + ${appId} + '/transactions?page=0&sortField=description&sortDir=' + ${reverseSortDir}}"
                       class="text-white text-decoration-none">
                        Description
                        <span th:if="${sortField == 'description'}"
                              th:text="${sortDir == 'asc' ? '↑' : '↓'}"></span>
                    </a>
                </th>
            </tr>
            </thead>

            <tbody>
            <tr th:if="${#lists.isEmpty(transactionsPage.content)}">
                <td colspan="4" class="text-center text-muted py-3">No transactions found</td>
            </tr>

            <tr th:each="tx : ${transactionsPage.content}">
                <td th:text="${tx.transactionId}"></td>
                <td th:text="${#temporals.format(tx.transactionDate, 'dd-MM-yyyy HH:mm:ss')}"></td>
                <td th:text="${#numbers.formatDecimal(tx.amount,1,'COMMA',2,'POINT')}"></td>
                <td th:text="${tx.description}"></td>
            </tr>
            </tbody>
        </table>
    </div>

    <!-- ✅ Pagination Controls -->
    <nav th:if="${transactionsPage.totalPages > 1}" class="mt-4">
        <ul class="pagination justify-content-center">

            <!-- Previous Button -->
            <li class="page-item" th:classappend="${transactionsPage.first} ? 'disabled'">
                <a class="page-link"
                   th:href="@{'/card/' + ${appId} + '/transactions?page=' + ${transactionsPage.number - 1}
               + '&sortField=' + ${sortField} + '&sortDir=' + ${sortDir}}">Previous</a>
            </li>

            <!-- Page Numbers -->
            <li class="page-item"
                th:each="i : ${#numbers.sequence(0, transactionsPage.totalPages - 1)}"
                th:classappend="${i == transactionsPage.number} ? 'active'">
                <a class="page-link"
                   th:text="${i + 1}"
                   th:href="@{'/card/' + ${appId} + '/transactions?page=' + ${i}
               + '&sortField=' + ${sortField} + '&sortDir=' + ${sortDir}}"></a>
            </li>

            <!-- Next Button -->
            <li class="page-item" th:classappend="${transactionsPage.last} ? 'disabled'">
                <a class="page-link"
                   th:href="@{'/card/' + ${appId} + '/transactions?page=' + ${transactionsPage.number + 1}
               + '&sortField=' + ${sortField} + '&sortDir=' + ${sortDir}}">Next</a>
            </li>
        </ul>
    </nav>


    <div class="mt-4 d-flex justify-content-center gap-3">
        <a href="/card/form" class="btn btn-primary">New Application</a>
        <a href="/card/all" class="btn btn-outline-secondary">All Applications</a>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
