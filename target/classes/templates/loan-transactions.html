<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Loan Transactions</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body class="container mt-4">

<div class="card shadow p-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="text-primary mb-0">
            Transactions for Application ID: <span th:text="${appId}"></span>
        </h2>
        <a class="btn btn-outline-secondary" href="/loan/all">← Back to Applications</a>
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-bordered align-middle text-center">
            <thead class="table-dark">
            <tr>
                <th>
                    <a th:href="@{'/loan/' + ${appId} + '/transactions?page=0&sortField=id&sortDir=' + ${reverseSortDir}}"
                       class="text-white text-decoration-none">
                        Transaction ID
                        <span th:if="${sortField == 'id'}"
                              th:text="${sortDir == 'asc' ? '↑' : '↓'}"></span>
                    </a>
                </th>

                <th>
                    <a th:href="@{'/loan/' + ${appId} + '/transactions?page=0&sortField=income&sortDir=' + ${reverseSortDir}}"
                       class="text-white text-decoration-none">
                        Income
                        <span th:if="${sortField == 'income'}"
                              th:text="${sortDir == 'asc' ? '↑' : '↓'}"></span>
                    </a>
                </th>

                <th>
                    <a th:href="@{'/loan/' + ${appId} + '/transactions?page=0&sortField=loanAmount&sortDir=' + ${reverseSortDir}}"
                       class="text-white text-decoration-none">
                        Loan Amount
                        <span th:if="${sortField == 'loanAmount'}"
                              th:text="${sortDir == 'asc' ? '↑' : '↓'}"></span>
                    </a>
                </th>

                <th>
                    <a th:href="@{'/loan/' + ${appId} + '/transactions?page=0&sortField=decision&sortDir=' + ${reverseSortDir}}"
                       class="text-white text-decoration-none">
                        Decision
                        <span th:if="${sortField == 'decision'}"
                              th:text="${sortDir == 'asc' ? '↑' : '↓'}"></span>
                    </a>
                </th>

                <th>
                    <a th:href="@{'/loan/' + ${appId} + '/transactions?page=0&sortField=timestamp&sortDir=' + ${reverseSortDir}}"
                       class="text-white text-decoration-none">
                        Timestamp
                        <span th:if="${sortField == 'timestamp'}"
                              th:text="${sortDir == 'asc' ? '↑' : '↓'}"></span>
                    </a>
                </th>
            </tr>
            </thead>

            <tbody>
            <tr th:if="${#lists.isEmpty(transactionsPage.content)}">
                <td colspan="5" class="text-center text-muted py-3">No transactions found</td>
            </tr>

            <tr th:each="tx : ${transactionsPage.content}">
                <td th:text="${tx.id}"></td>
                <td th:text="${#numbers.formatDecimal(tx.income,1,'COMMA',2,'POINT')}"></td>
                <td th:text="${#numbers.formatDecimal(tx.loanAmount,1,'COMMA',2,'POINT')}"></td>
                <td>
                    <span th:class="${tx.decision == 'APPROVED' ? 'badge bg-success fs-6 p-2' :
                                     tx.decision == 'REJECTED' ? 'badge bg-danger fs-6 p-2' :
                                     'badge bg-secondary fs-6 p-2'}"
                          th:text="${tx.decision}">
                    </span>
                </td>
                <td th:text="${#temporals.format(tx.timestamp, 'yyyy-MM-dd HH:mm:ss')}"></td>
            </tr>
            </tbody>
        </table>
    </div>

    <!-- Pagination Controls -->
    <nav th:if="${transactionsPage.totalPages > 1}" class="mt-3">
        <ul class="pagination justify-content-center">

            <li class="page-item" th:classappend="${transactionsPage.first} ? 'disabled'">
                <a class="page-link"
                   th:href="@{'/loan/' + ${appId} + '/transactions?page=' + ${transactionsPage.number - 1}
                   + '&sortField=' + ${sortField} + '&sortDir=' + ${sortDir}}">Previous</a>
            </li>

            <li class="page-item"
                th:each="i : ${#numbers.sequence(0, transactionsPage.totalPages - 1)}"
                th:classappend="${i == transactionsPage.number} ? 'active'">
                <a class="page-link"
                   th:text="${i + 1}"
                   th:href="@{'/loan/' + ${appId} + '/transactions?page=' + ${i}
                   + '&sortField=' + ${sortField} + '&sortDir=' + ${sortDir}}"></a>
            </li>

            <li class="page-item" th:classappend="${transactionsPage.last} ? 'disabled'">
                <a class="page-link"
                   th:href="@{'/loan/' + ${appId} + '/transactions?page=' + ${transactionsPage.number + 1}
                   + '&sortField=' + ${sortField} + '&sortDir=' + ${sortDir}}">Next</a>
            </li>
        </ul>
    </nav>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
